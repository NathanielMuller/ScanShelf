<ion-content class="login-page" fullscreen>
  <!-- Hero Section con animación -->
  <div class="hero" @heroAnimation>
    <div class="hero-content">
      <ion-icon name="scan-outline" class="hero-icon"></ion-icon>
      <h1 class="hero-title">Bienvenido a ScanShelf</h1>
      <p class="hero-subtitle">Gestiona tu inventario de forma inteligente</p>
    </div>
  </div>

  <!-- Login Card -->
  <div class="login-container">
    <ion-card 
      class="login-card card-modern" 
      #loginCard 
      [@shakeAnimation]="shakeState"
    >
      <ion-card-header>
        <ion-card-title class="card-title">
          {{ isConfiguringPin ? 'Configura tu Cuenta' : 'Iniciar Sesión' }}
        </ion-card-title>
        <ion-card-subtitle class="card-subtitle">
          {{ isConfiguringPin ? (pinToConfirm ? 'Confirma tu PIN de 6 dígitos' : 'Personaliza tu perfil y crea un PIN') : 'Ingresa tu PIN para continuar' }}
        </ion-card-subtitle>
      </ion-card-header>

      <ion-card-content>
        <form [formGroup]="loginForm" (ngSubmit)="onSubmit()">
          <!-- Campo Nombre de Usuario (solo durante configuración) -->
          <div class="input-group" *ngIf="isConfiguringPin && !pinToConfirm">
            <ion-item 
              lines="none" 
              class="input-item"
              [class.error]="hasError('username', 'minlength') || hasError('username', 'maxlength')"
            >
              <ion-label position="stacked">Nombre de Usuario</ion-label>
              <ion-input 
                type="text" 
                formControlName="username"
                placeholder="¿Cómo te llamas?"
                maxlength="20"
                autocomplete="off"
                aria-label="Nombre de usuario"
              ></ion-input>
            </ion-item>
            <div class="error-message" *ngIf="(loginForm.get('username')?.dirty || loginForm.get('username')?.touched) && loginForm.get('username')?.invalid">
              {{ getErrorMessage('username') }}
            </div>
            <p class="hint-text">
              <ion-icon name="information-circle-outline"></ion-icon>
              Opcional. Si lo dejas vacío, usaremos "Usuario"
            </p>
          </div>

          <!-- Campo PIN -->
          <div class="input-group">
            <ion-item 
              lines="none" 
              class="input-item"
              [class.error]="hasError('pin', 'required') || hasError('pin', 'pattern')"
            >
              <ion-label position="stacked">PIN</ion-label>
              <ion-input 
                type="password" 
                formControlName="pin"
                placeholder="6 dígitos"
                maxlength="6"
                inputmode="numeric"
                autocomplete="off"
                aria-label="PIN de 6 dígitos"
              ></ion-input>
            </ion-item>
            <div class="error-message" *ngIf="(loginForm.get('pin')?.dirty || loginForm.get('pin')?.touched) && loginForm.get('pin')?.invalid">
              {{ getErrorMessage('pin') }}
            </div>
            
            <!-- Indicador de fuerza del PIN (solo durante configuración) -->
            <div *ngIf="isConfiguringPin && loginForm.get('pin')?.value" class="pin-strength">
              <div class="strength-bar">
                <div class="strength-fill" 
                     [style.width.%]="getPinStrength(loginForm.get('pin')?.value).percentage"
                     [class.weak]="getPinStrength(loginForm.get('pin')?.value).level === 'weak'"
                     [class.fair]="getPinStrength(loginForm.get('pin')?.value).level === 'fair'"
                     [class.good]="getPinStrength(loginForm.get('pin')?.value).level === 'good'"
                     [class.strong]="getPinStrength(loginForm.get('pin')?.value).level === 'strong'">
                </div>
              </div>
              <p class="strength-text">{{ getPinStrength(loginForm.get('pin')?.value).message }}</p>
            </div>
          </div>

          <!-- Botones de acción -->
          <div class="button-group">
            <ion-button 
              type="submit"
              expand="block" 
              class="btn-primary login-btn"
              [disabled]="isLoading"
              aria-label="Continuar"
            >
              <ion-icon [name]="isConfiguringPin ? 'save-outline' : 'log-in-outline'" slot="start" *ngIf="!isLoading"></ion-icon>
              <ion-spinner name="crescent" *ngIf="isLoading"></ion-spinner>
              {{ isLoading ? 'Procesando...' : (isConfiguringPin ? (pinToConfirm ? 'Confirmar PIN' : 'Continuar') : 'Desbloquear') }}
            </ion-button>
          </div>
        </form>
      </ion-card-content>
    </ion-card>

    <!-- Información adicional -->
    <div class="info-section">
      <p class="demo-info">
        <ion-icon name="information-circle-outline"></ion-icon>
        <strong>{{ isConfiguringPin ? 'Configuración inicial:' : 'Seguridad:' }}</strong> 
        {{ isConfiguringPin ? 'Crea un PIN de 6 dígitos para proteger tu cuenta' : 'Usa tu PIN de 6 dígitos para acceder' }}
      </p>
    </div>
  </div>

  <!-- Footer -->
  <div class="footer">
    <p class="footer-text">
      ScanShelf v1.0 · Gestión de Inventario
    </p>
  </div>
</ion-content>
